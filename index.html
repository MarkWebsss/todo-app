<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productivity To-Do List</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="//unpkg.com/alpinejs" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
</head>
<body class="bg-gradient-to-r from-blue-100 via-purple-100 to-pink-100 flex flex-col items-center min-h-screen px-3">

  <div 
    x-data="todoApp()" 
    x-init="loadTasks()" 
    class="m-6 bg-white/80 backdrop-blur-xl shadow-2xl rounded-2xl w-full max-w-5xl p-4 sm:p-6 border border-gray-200"
  >
    <!-- Title -->
    <h1 class="text-2xl sm:text-3xl font-extrabold text-center mb-4 sm:mb-6 text-gray-800 tracking-wide">
      My Productivity Board
    </h1>
    
    <!-- Input with Date & Time -->
    <form @submit.prevent="addTask" class="flex flex-col sm:flex-row gap-3 mb-6">
      <input 
        type="text" 
        x-model="newTask"
        placeholder="Task name..." 
        class="flex-1 px-4 py-2 sm:py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-gray-700 text-sm sm:text-base"
      >
      <input 
        type="date" 
        x-model="newDate"
        class="px-4 py-2 sm:py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-gray-700 text-sm sm:text-base"
      >
      <input 
        type="time" 
        x-model="newTime"
        class="px-4 py-2 sm:py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-gray-700 text-sm sm:text-base"
      >
      <button 
        type="submit"
        class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white p-2 sm:p-3 rounded-xl shadow-md transition-all duration-300 flex items-center justify-center"
        title="Add Task"
      >
        <!-- Plus Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
      </button>
    </form>

    <!-- Tasks & Completed Split -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Active Tasks -->
      <div class="bg-white/90 border border-purple-300 rounded-2xl p-4 shadow-md hover:shadow-lg transition">
        <h2 class="text-lg sm:text-xl font-bold mb-3 text-gray-700 flex justify-between items-center">
          üìù Active Tasks 
          <span class="text-xs sm:text-sm text-gray-500" x-text="tasks.filter(t => !t.done).length + ' left'"></span>
        </h2>
        <ul class="space-y-3">
          <template x-for="(task, index) in tasks" :key="index">
            <li 
              x-show="!task.done"
              class="bg-white p-3 sm:p-4 rounded-xl shadow hover:shadow-lg transition-all duration-300 border border-gray-100"
              x-transition
            >
              <div class="flex items-start justify-between">
                <div class="flex items-start space-x-3">
                  <input 
                    type="checkbox" 
                    x-model="task.done" 
                    @change="markCompleted(task)"
                    class="mt-1 w-5 h-5 text-purple-500 rounded focus:ring-pink-400"
                  >
                  <div>
                    <span x-text="task.text" class="text-gray-700 font-medium block text-sm sm:text-base"></span>
                    <small class="text-gray-500 block" x-show="task.date || task.time">
                      Due: <span x-text="task.date"></span> <span x-text="task.time"></span>
                    </small>
                  </div>
                </div>
                <button 
                  @click="removeTask(index)" 
                  class="text-red-400 hover:text-red-600 transition"
                >
                  ‚úñ
                </button>
              </div>
            </li>
          </template>
        </ul>
        <p x-show="tasks.filter(t => !t.done).length === 0" class="text-gray-400 mt-3 text-sm">
          Nothing to do... üå±
        </p>
      </div>

      <!-- Completed Tasks -->
      <div class="bg-green-50 border border-green-300 rounded-2xl p-4 shadow-md hover:shadow-lg transition">
        <h2 class="text-lg sm:text-xl font-bold mb-3 text-gray-700 flex items-center justify-between">
          ‚úÖ Completed
          <div class="flex gap-2">
            <!-- Clear All -->
            <button 
              @click="clearCompleted()" 
              class="text-xs sm:text-sm bg-red-100 text-red-500 px-2 sm:px-3 py-1 rounded-lg hover:bg-red-200 transition"
              x-show="tasks.filter(t => t.done).length > 0"
            >
              Clear All
            </button>

            <!-- Repeat All -->
            <button 
              @click="repeatAllCompleted()" 
              class="text-xs sm:text-sm bg-blue-100 text-blue-500 px-2 sm:px-3 py-1 rounded-lg hover:bg-blue-200 transition"
              x-show="tasks.filter(t => t.done).length > 0"
            >
              Repeat All
            </button>
          </div>
        </h2>
        <ul class="space-y-3">
          <template x-for="(task, index) in tasks" :key="index">
            <li 
              x-show="task.done"
              class="bg-green-100 p-3 sm:p-4 rounded-xl shadow-inner border border-green-200"
              x-transition
            >
              <div class="flex items-start justify-between">
                <div class="flex items-start space-x-3">
                  <input 
                    type="checkbox" 
                    x-model="task.done" 
                    @change="saveTasks(); updateChart()"
                    class="mt-1 w-5 h-5 text-green-500 rounded focus:ring-green-400"
                  >
                  <div>
                    <span x-text="task.text" class="line-through text-gray-500 block text-sm sm:text-base"></span>
                    <small class="text-gray-400 block" x-show="task.date || task.time">
                      Done: <span x-text="task.date"></span> <span x-text="task.time"></span>
                    </small>
                  </div>
                </div>
                <button 
                  @click="removeTask(index)" 
                  class="text-red-400 hover:text-red-600 transition"
                >
                  ‚úñ
                </button>
              </div>
            </li>
          </template>
        </ul>
        <p x-show="tasks.filter(t => t.done).length === 0" class="text-gray-400 mt-3 text-sm">
          No finished tasks yet... üí§
        </p>
      </div>
    </div>

    <!-- Productivity Chart -->
    <div class="mt-8">
      <h2 class="text-lg sm:text-xl font-bold mb-3 text-gray-700">üìä Weekly Productivity</h2>
      <canvas id="productivityChart" class="w-full h-64"></canvas>
    </div>

    <button 
      @click="showWeeklyReport()" 
      class="bg-purple-500 text-white px-3 py-2 rounded-lg hover:bg-purple-600 transition mt-3">
      üìä Weekly Report
    </button>
  </div>
  <!-- Footer -->
  <footer class="mt-6 mb-4 text-gray-600 text-sm text-center">
    ¬© 2025 Made by <span class="font-semibold"><a href="https://github.com/MarkWebsss">MarkWebsss</a></span>
  </footer>

<script>
  function todoApp() {
    return {
      newTask: '',
      newDate: '',
      newTime: '',
      tasks: [],
      chart: null,

      // suggestions
      newSuggestion: '',
      suggestions: [],

      loadTasks() {
        const saved = localStorage.getItem('tasks');
        this.tasks = saved ? JSON.parse(saved) : [];
        this.$nextTick(() => this.updateChart());
      },

      saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(this.tasks));
        this.updateChart();
      },

      loadSuggestions() {
        const saved = localStorage.getItem('suggestions');
        this.suggestions = saved ? JSON.parse(saved) : [];
      },

      addSuggestion() {
        if (this.newSuggestion.trim() === '') {
          Swal.fire({ icon: 'warning', title: 'Oops...', text: 'Please write a suggestion before submitting!', confirmButtonColor: '#a855f7' });
          return;
        }
        this.suggestions.push(this.newSuggestion.trim());
        this.newSuggestion = '';
        localStorage.setItem('suggestions', JSON.stringify(this.suggestions));
        Swal.fire({ icon: 'success', title: 'Thank you!', text: 'Your suggestion was submitted.', timer: 1500, showConfirmButton: false });
      },

      markCompleted(task) {
        if (task.done && !task.completedAt) {
          task.completedAt = new Date().toISOString();
        }
        this.saveTasks();
      },

      addTask() {
        if (this.newTask.trim() === '') {
          Swal.fire({ icon: 'warning', title: 'Oops...', text: 'Please enter a task before adding!', confirmButtonColor: '#a855f7' });
          return;
        }

        Swal.fire({ title: 'Adding...', text: 'Please wait a moment', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

        setTimeout(() => {
          this.tasks.push({ text: this.newTask, date: this.newDate, time: this.newTime, done: false });
          this.newTask = ''; this.newDate = ''; this.newTime = '';
          this.saveTasks();
          Swal.fire({ icon: 'success', title: 'Added!', text: 'Your task was successfully added.', timer: 1500, showConfirmButton: false });
        }, 800);
      },

      removeTask(index) {
        Swal.fire({
          title: 'Are you sure?', text: "This task will be deleted.", icon: 'warning', showCancelButton: true,
          confirmButtonColor: '#ef4444', cancelButtonColor: '#6b7280', confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
          if (result.isConfirmed) {
            this.tasks.splice(index, 1);
            this.saveTasks();
            Swal.fire({ icon: 'success', title: 'Deleted!', text: 'Your task has been removed.', timer: 1200, showConfirmButton: false });
          }
        });
      },

      clearCompleted() {
        if (!this.tasks.some(t => t.done)) {
          Swal.fire({ icon: 'info', title: 'No completed tasks', text: 'There are no tasks marked as done yet.', confirmButtonColor: '#3b82f6' });
          return;
        }
        Swal.fire({
          title: 'Clear completed tasks?', text: "This cannot be undone.", icon: 'warning', showCancelButton: true,
          confirmButtonColor: '#ef4444', cancelButtonColor: '#6b7280', confirmButtonText: 'Yes, clear them!'
        }).then((result) => {
          if (result.isConfirmed) {
            this.tasks = this.tasks.filter(t => !t.done);
            this.saveTasks();
            Swal.fire({ icon: 'success', title: 'Cleared!', text: 'All completed tasks have been removed.', timer: 1200, showConfirmButton: false });
          }
        });
      },

      repeatAllCompleted() {
        const completed = this.tasks.filter(t => t.done);
        if (completed.length === 0) {
          Swal.fire({ icon: 'info', title: 'No completed tasks', text: 'There are no tasks to repeat.', confirmButtonColor: '#3b82f6' });
          return;
        }

        Swal.fire({ title: 'Repeating...', text: 'Please wait a moment', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

        setTimeout(() => {
          completed.forEach(task => {
            this.tasks.push({ text: task.text, date: task.date, time: task.time, done: false });
          });
          this.tasks = this.tasks.filter(t => !t.done);
          this.saveTasks();
          Swal.fire({ icon: 'success', title: 'Repeated!', text: 'Completed tasks have been repeated and cleared.', timer: 1500, showConfirmButton: false });
        }, 800);
      },

      updateChart() {
        let weeklyData = {};
        this.tasks.forEach(t => {
          if (t.done && t.completedAt) {
            let date = new Date(t.completedAt);
            let firstDay = new Date(date.getFullYear(), 0, 1);
            let days = Math.floor((date - firstDay) / (24 * 60 * 60 * 1000));
            let week = Math.ceil((days + firstDay.getDay() + 1) / 7);
            let label = `Week ${week}`;
            weeklyData[label] = (weeklyData[label] || 0) + 1;
          }
        });

        let labels = Object.keys(weeklyData);
        let data = Object.values(weeklyData);

        if (this.chart) this.chart.destroy();

        let ctx = document.getElementById('productivityChart').getContext('2d');
        this.chart = new Chart(ctx, {
          type: 'bar',
          data: { labels: labels, datasets: [{ label: 'Tasks Completed', data: data, backgroundColor: '#4f46e5' }] },
          options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });
      },

      showWeeklyReport() {
        const completed = this.tasks.filter(t => t.done && t.completedAt);
        if (completed.length === 0) {
          Swal.fire({
            icon: 'info',
            title: 'No Report Yet',
            text: 'Complete some tasks to generate a report.',
            confirmButtonColor: '#3b82f6'
          });
          return;
        }

        let weeklyData = {};
        let weeklyTasks = {};
        completed.forEach(task => {
          let date = new Date(task.completedAt);
          let firstDay = new Date(date.getFullYear(), 0, 1);
          let days = Math.floor((date - firstDay) / (24 * 60 * 60 * 1000));
          let week = Math.ceil((days + firstDay.getDay() + 1) / 7);
          let label = `Week ${week}`;

          weeklyData[label] = (weeklyData[label] || 0) + 1;
          if (!weeklyTasks[label]) weeklyTasks[label] = [];
          weeklyTasks[label].push(task.text);
        });

        let labels = Object.keys(weeklyData);
        let data = Object.values(weeklyData);

        let reportList = '';
        labels.forEach(label => {
          reportList += `<p><b>${label}:</b> ${weeklyTasks[label].join(', ')}</p>`;
        });

        Swal.fire({
          title: 'Weekly Productivity Report',
          html: `
            <canvas id="weeklyReportChart" style="width:100%;max-height:300px;"></canvas>
            <div style="text-align:left;margin-top:15px;">${reportList}</div>
          `,
          width: 600,
          didOpen: () => {
            let ctx = document.getElementById('weeklyReportChart').getContext('2d');
            new Chart(ctx, {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Tasks Completed',
                  data: data,
                  backgroundColor: '#10b981'
                }]
              },
              options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
              }
            });
          },
          confirmButtonColor: '#a855f7'
        });
      }
    }
  }
</script>
<!-- Floating Suggestion Button -->
<div id="suggestion-btn" class="fixed bottom-5 right-5 z-50 animate-bounce">
  <button class="bg-indigo-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-indigo-700 hover:scale-105 transition transform"
          onclick="toggleForm()">
    üí° Suggestion
  </button>
</div>

<!-- Popup Form -->
<div id="suggestion-form" class="fixed bottom-20 right-5 w-80 bg-white shadow-lg rounded p-4 z-50 opacity-0 translate-y-10 pointer-events-none transition-all duration-500">
  <h3 class="text-lg font-semibold mb-2 text-gray-800">Send a Suggestion</h3>
  <form id="contact-form-floating" class="space-y-2 text-black">
    <input type="text" name="name" placeholder="Your Name(optional)" 
           class="w-full p-2 border border-gray-300 rounded focus:ring focus:ring-indigo-300" />
    <input type="email" name="email" placeholder="Your Email" required
           class="w-full p-2 border border-gray-300 rounded focus:ring focus:ring-indigo-300" />
    <textarea name="message" rows="3" placeholder="Your Suggestion" required
           class="w-full p-2 border border-gray-300 rounded focus:ring focus:ring-indigo-300"></textarea>
    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 transition">
      Send
    </button>
    <p id="form-status-floating" class="text-sm mt-2 hidden"></p>
  </form>
</div>

<script>
function toggleForm() {
  const form = document.getElementById("suggestion-form");
  const btnDiv = document.getElementById("suggestion-btn");

  if (form.classList.contains("opacity-0")) {
    form.classList.remove("opacity-0", "translate-y-10", "pointer-events-none");
    form.classList.add("opacity-100", "translate-y-0");
    btnDiv.classList.remove("animate-bounce"); // stop bounce
  } else {
    form.classList.add("opacity-0", "translate-y-10", "pointer-events-none");
    form.classList.remove("opacity-100", "translate-y-0");
    btnDiv.classList.add("animate-bounce"); // resume bounce
  }
}

document.getElementById("contact-form-floating").addEventListener("submit", async function(e) {
  e.preventDefault();
  const form = e.target;
  const status = document.getElementById("form-status-floating");
  const data = new FormData(form);

  try {
    const response = await fetch("https://formspree.io/f/xrblrvrn", {
      method: "POST",
      body: data,
      headers: { 'Accept': 'application/json' }
    });

    if (response.ok) {
      form.reset();
      status.textContent = "Message sent successfully!";
      status.className = "text-green-500 mt-2";
      status.classList.remove("hidden");
    } else {
      status.textContent = "Oops! Something went wrong.";
      status.className = "text-red-500 mt-2";
      status.classList.remove("hidden");
    }
  } catch (error) {
    status.textContent = "Network error. Please try again.";
    status.className = "text-red-500 mt-2";
    status.classList.remove("hidden");
  }
});
</script>


</body>
</html>
